# MuleSoft Semgrep Rules â€” Security: Hardcoded Credentials
# Category : security
# Severity : ERROR
# Use      : semgrep --config rules/security/credentials.yaml
---
rules:
  - id: mulesoft-hardcoded-db-password
    message: >
      Hardcoded database password detected in connection config.
      Replace with a secure property placeholder: password="${secure::db.password}"
      and store the secret in a secrets manager (Vault, AWS Secrets Manager, etc.).
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
      references:
        - https://docs.mulesoft.com/mule-runtime/latest/secure-configuration-properties
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
    patterns:
      - pattern: '<db:connection password="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-http-basic-auth
    message: >
      Hardcoded HTTP Basic Authentication password.
      Replace with: password="${secure::http.auth.password}"
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
    patterns:
      - pattern: '<http:basic-authentication password="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-oauth-client-secret
    message: >
      Hardcoded OAuth2 client secret detected.
      Replace with: clientSecret="${secure::oauth.client.secret}"
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
    patterns:
      - pattern: '<oauth2:token-request ... clientSecret="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-ftp-sftp-password
    message: >
      Hardcoded FTP/SFTP password detected.
      Replace with: password="${secure::ftp.password}"
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
    patterns:
      - pattern-either:
          - pattern: '<ftp:connection password="$VALUE" ... />'
          - pattern: '<sftp:connection password="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-jms-password
    message: >
      Hardcoded JMS/ActiveMQ password detected.
      Replace with: password="${secure::jms.password}"
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
    patterns:
      - pattern: '<jms:config password="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-salesforce-password
    message: >
      Hardcoded Salesforce password or security token detected.
      Replace with: password="${secure::sf.password}" securityToken="${secure::sf.token}"
    severity: ERROR
    languages: [xml]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 - Identification and Authentication Failures"
      confidence: HIGH
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
    patterns:
      - pattern-either:
          - pattern: '<salesforce:cached-basic-connection password="$VALUE" ... />'
          - pattern: '<salesforce:basic-connection password="$VALUE" ... />'
      - metavariable-regex:
          metavariable: $VALUE
          regex: '^(?!\$\{)(?!\s*$).+'

  - id: mulesoft-hardcoded-secret-in-properties-file
    message: >
      Hardcoded secret value found in a properties or config file.
      Move sensitive values to a secrets manager and reference them via ${secure::key}.
      Ensure the file is excluded from version control.
    severity: ERROR
    languages: [generic]
    metadata:
      category: security
      subcategory: [vuln]
      cwe: "CWE-312: Cleartext Storage of Sensitive Information"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: MEDIUM
      references:
        - https://docs.mulesoft.com/mule-runtime/latest/secure-configuration-properties
    paths:
      include:
        - "*.dwl"
        - "*.yaml"
        - "*.xml"
      exclude:
        - "pom.xml"
        - "**/test/**"
        - "**/src/test/**"
    patterns:
      - pattern-regex: '(?i)(password|passwd|secret|api[._-]?key|token|client[._-]?secret|private[._-]?key)\s*[:=]\s*(?!\$\{)(?!\s*$)[^\s#]+'
